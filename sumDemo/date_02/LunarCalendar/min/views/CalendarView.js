(function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};window.HuangLi=window.HuangLi||{},define(["jquery","util","handlebars","Templates","LunarCore"],function(t,n,r,i,s){var o;return o=function(){function r(){this.showHL=e(this.showHL,this),this.initialize()}return r.prototype.initialize=function(){return this.calendarPanel=t("#calendarPanel"),this.btnPrev=t("#jsPrevMonth"),this.btnNext=t("#jsNextMonth"),this.btnReturnToday=t("#jsReturnTodayBtn"),this.labGregorian=t("#jsGregorianLab"),this.labYearMonth=t("#jsYearMonthLab"),this.weekList=t("#jsWeekList"),this.Yi=t("#jsYiLab"),this.Ji=t("#jsJiLab"),this.hlurl="http://s.yunfan.com/js/LunarCalendar/1.0/data",this.ganZhi=t("#jsLunarcalendarLab"),this.hlMinYear=2008,this.hlMaxYear=2020,this.minYear=1891,this.maxYear=2100,this.now=new Date,this.current=null,this.DATA=null,this.panel=[0,1],this.pageWidth=0,this.slideIng=!1,this.timer=-1,this.eventBind().setCurrentByNow().showDate().getYearMonth(),this},r.prototype.formateDayD4=function(e,t){return e+=1,e=e<10?"0"+e:e,t=t<10?"0"+t:t,"d"+e+t},r.prototype.formatDate=function(){var e,t,n;return this.current?(n=this.current.year,t=this.current.month,e=this.current.day,t=t<10?"0"+t:t,e=e<10?"0"+e:e,""+n+"-"+t+"-"+e):""},r.prototype.setCurrentByNow=function(e,t,n,r){return this.current={year:e||this.now.getFullYear(),month:t||this.now.getMonth()+1,day:n||this.now.getDate(),pos:r||0},this},r.prototype.getHL=function(){var e;if(HuangLi["y"+this.current.year])return e=HuangLi["y"+this.current.year][this.formateDayD4(this.current.month-1,this.current.day)],this.showHL(e);if(this.current.year>=this.hlMinYear&&this.current.year<=this.hlMaxYear)return require([""+this.hlurl+"/hl"+this.current.year+".js"],function(t){return function(n){return e=HuangLi["y"+t.current.year][t.formateDayD4(t.current.month-1,t.current.day)],t.showHL(e)}}(this))},r.prototype.showHL=function(e){return this.Ji.text(e!=null?e.j:void 0),this.Yi.text(e!=null?e.y:void 0),this},r.prototype.showInfo=function(e){var n,r,i,o,u;return this.currentMonth=this.current.month-1,this.currentYear=this.current.year,n=s.solarToLunar(this.current.year,this.current.month,this.current.day),o=(new Date(this.current.year,this.current.month-1,this.current.day)).getDay(),i=["日","一","二","三","四","五","六"],u="【"+n.zodiac+"年】"+n.lunarMonthName+n.lunarDayName,r=[],n.term&&r.push(n.term),n.lunarFestival&&r.push(n.lunarFestival),n.solarFestival&&r.push(n.solarFestival.split(" ")),e&&(t("a.click").removeClass("click"),t(e.find("a")).addClass("click")),this.ganZhi.html(u),this.labYearMonth.html(""+this.current.year+"-"+this.current.month),this.current.year===this.now.getFullYear()&&this.current.month===this.now.getMonth()+1&&this.current.day===this.now.getDate()?this.labGregorian.html("<span class='today'></span><span class='returnToday' style='display:none'></span>"+this.current.year+"年"+this.current.month+"月"+this.current.day+" 周"+i[o]):this.labGregorian.html("<span class='returnToday'></span>"+this.current.year+"年"+this.current.month+"月"+this.current.day+" 周"+i[o]),this.getHL(),this},r.prototype.resetInfo=function(){var e;return e=this.calendarPanel.find("li").eq(current.pos),this.now.getFullYear()===this.current.year&&this.now.getMonth()+1===this.current.month&&this.now.getDate()===this.current.day?e.attr("class","date_item date_today"):e.attr("class","date_item"),this},r.prototype.showDate=function(){var e,n,r,o,u,a,f,l,c,h,p,d,v,m,g,y;this.DATA=s.calendar(this.current.year,this.current.month,!0),e="",v=i.DAY_ITEMS,l=0;while(l<this.DATA.monthData.length){p=this.DATA.monthData[l],l===0&&(n=this.DATA.monthData[this.DATA.monthData.length-1],a=this.getWeeks(""+p.year+"-"+p.month+"-"+p.day),r=this.getWeeks(""+n.year+"-"+n.month+"-"+n.day),this.setCurrMonthWeek(a,r)),c="",f=null,g=null,p.worktime?c=p.worktime===1?"worktime":"holiday":c="",u="",p.lunarFestival||p.term?u=" lunar_fetv":u=p.solarFestival?" label-color":"",c==="holiday"&&(f="holiday"),c==="worktime"&&(g="work"),m="",y=new Date(p.year,p.month-1,p.day);if(y.getDay()===0||y.getDay()===6)m="label-color";o={index:l,itemCls:"",hdays:f,works:g,fetvCls:u,weekday:m,lunar:""},h="",this.now.getFullYear()===p.year&&this.now.getMonth()+1===p.month&&this.now.getDate()===p.day?h="normal selected":this.current.year===p.year&&this.current.month===p.month&&this.current.day===p.day?(h="click",this.current.pos=l):l<this.DATA.firstDay||l>=this.DATA.firstDay+this.DATA.monthDays?h="abnormal":h="normal",o.itemCls=h,d=p.lunarDayName,p.solarFestival&&(o.fetvCls="label-color",d=p.solarFestival),p.lunarFestival&&(o.fetvCls="label-color",d=p.lunarFestival),p.term&&(d=p.term,o.fetvCls="label-color"),o.lunar=d,t.extend(p,o),e+=v(p),l++}return this.calendarPanel.html(e),this.showInfo(),this},r.prototype.pageDate=function(e,t,n,r){var i,s,o;o=0,s=0,i=0,t&&n?(o=t,s=n):this.current.month+e<1?(o=this.current.year-1,s=12):this.current.month+e>12?(o=this.current.year+1,s=1):(o=this.current.year,s=this.current.month+e),r?i=r:this.current.day>LunarCalendar.getSolarMonthDays[s-1]?i=LunarCalendar.getSolarMonthDays[s-1]:i=this.current.day;if(o<this.minYear||o>this.maxYear)return;return this.setCurrentByNow(o,s,i),this.showDate(),this},r.prototype.getYearMonth=function(e){var t;return this.currentDate=new Date,e?e===1?(this.currentMonth+=1,this.currentMonth>=12&&(this.currentMonth=0,this.currentYear+=1),this.pageDate(1,this.currentYear,this.currentMonth+1,1)):(this.currentMonth-=1,this.currentMonth<0&&(this.currentMonth=11,this.currentYear-=1),this.pageDate(-1,this.currentYear,this.currentMonth+1,1)):(this.currentYear=this.currentDate.getFullYear(),this.currentMonth=this.currentDate.getMonth()),t=this.currentMonth+1<10?n.format("0{0}",this.currentMonth+1):this.currentMonth+1,this.labYearMonth.html(n.format("{0}-{1}",this.currentYear,t)),this},r.prototype.eventBind=function(){var e;return e=this,this.btnPrev.on("click",function(e){return function(){return e.getYearMonth(-1)}}(this)),this.btnNext.on("click",function(e){return function(){return e.getYearMonth(1)}}(this)),this.calendarPanel.delegate("li","click",function(){var n,r;return n=t(this).attr("data-index"),n=parseInt(n,10),r=e.DATA.monthData[n],n<e.DATA.firstDay?e.pageDate(-1,r.year,r.month,r.day):n>=e.DATA.firstDay+e.DATA.monthDays?e.pageDate(1,r.year,r.month,r.day):(e.setCurrentByNow(r.year,r.month,r.day,n),e.showInfo(t(this)))}),t(document.body).delegate(".returnToday","click",function(){return e.setCurrentByNow().showDate().getYearMonth()}),this},r.prototype.getYearWeek=function(e,t){var n,r,i,s,o;return r=new Date(e,t-1,1),i=new Date(e,0,1),s=r.getDay(),s===0&&(s=7),o=i.getDay(),o===0&&(o=7),n=Math.round((r.getTime()-i.getTime()+(o-s)*864e5)/864e5),Math.ceil(n/7)+1},r.prototype.setCurrMonthWeek=function(e,t){var n,r,s,o;r=0,o=[],e>t?(r=e+5-t,s=t):r=t,n=e;while(n<=r)o.push({week:n}),n++;n=1;while(n<=s&&s>0)o.push({week:n}),n++;return this.weekList.html(i.WEEK_ITEM({data:o})),this},r.prototype.getWeeks=function(e){var t,n,r,i,s,o,u,a,f,l,c,h,p;if(e){e=e.split("-");try{p=e[0],o=new Date(e[0],e[1]-1,e[2],0,0,0,0),o=o.getDay()>=0?o:!1}catch(d){l=d,o=!1}}o||(o=new Date,p=o.getYear()),f=864e5,i=new Date(p,0,1,0,0,0,0),s=i.getDay()===0?7:i.getDay(),t=(o.getTime()-i.getTime())/f;if(s<=4){if(t+s<=7)return 1;t+=i.getDay()}else if(t+s<=7){p-=1,c=31;while(c>24){h=this.getWeeks(""+p+"-12-"+c);if(h>10)return h;c--}}else t-=7-s;r=t/7;if(Math.ceil(r)===r)return r;u=new Date(p,11,31,0,0,0,0),a=u.getDay()===0?7:u.getDay();if(a<4){n=(u-o)/f;if(n<a)return 1}return Math.ceil(r)},r}()})}).call(this);